{
    "sourceFile": "img.py",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 14,
            "patches": [
                {
                    "date": 1757089334666,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1757089340461,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -20,20 +20,18 @@\n     \"\"\"Extract metadata from an image file using PIL.\"\"\"\n     try:\n         with Image.open(filepath) as img:\n             width, height = img.size\n-            dpi = img.info.get(\"dpi\", (None, None))  # Extract DPI if available\n-            dpi_x = dpi[0] if dpi and len(dpi) > 0 else None\n-            dpi_y = dpi[1] if dpi and len(dpi) > 1 else None\n+            dpi = img.info.get(\"dpi\", (None, None))\n+            dpi_x, dpi_y = (dpi[0] if dpi else None), (dpi[1] if dpi else None)\n             file_size = os.path.getsize(filepath)\n             return width, height, dpi_x, dpi_y, file_size\n     except Exception as e:\n         print(f\"Error getting image metadata for {filepath}: {e}\")\n         return None, None, None, None, None\n \n-\n-# Function to format file size\n def format_file_size(size_in_bytes):\n+    \"\"\"Format file size into a human-readable string.\"\"\"\n     try:\n         thresholds = [\n             (1024**4, \"TB\"),\n             (1024**3, \"GB\"),\n"
                },
                {
                    "date": 1757089348767,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -40,21 +40,23 @@\n             (1024**0, \"B\"),\n         ]\n         for factor, suffix in thresholds:\n             if size_in_bytes >= factor:\n-                break\n-        return f\"{size_in_bytes / factor:.2f} {suffix}\"\n+                return f\"{size_in_bytes / factor:.2f} {suffix}\"\n+        return \"0 B\"\n     except Exception as e:\n         print(f\"Error formatting file size: {e}\")\n         return \"Unknown\"\n \n-\n-# Function to generate a CSV for organizing image files\n def generate_csv(directories, csv_path):\n+    \"\"\"Generate a CSV for organizing image files.\"\"\"\n     rows = []\n-\n-    # Regex patterns for exclusions\n     excluded_patterns = [\n+        r\"^\\..*\", r\".*\\/venv\\/.*\", r\".*\\/\\.venv\\/.*\", r\".*\\/my_global_venv\\/.*\",\n+        r\".*\\/simplegallery\\/.*\", r\".*\\/avatararts\\/.*\", r\".*\\/github\\/.*\",\n+        r\".*\\/Documents\\/gitHub\\/.*\", r\".*\\/\\.my_global_venv\\/.*\", r\".*\\/node\\/.*\",\n+        r\".*\\/Movies\\/capcut\\/.*\", r\".*\\/miniconda3\\/.*\", r\".*\\/Movies\\/movavi\\/.*\",\n+        r\".*\\/env\\/.*\", r\".*\\/\\.env\\/.*\", r\".*\\/Library\\/.*\", r\".*\\/\\.config\\/.*\",\n         r\"^\\..*\",  # Hidden files and directories\n         r\".*\\/venv\\/.*\",  # venv directories\n         r\".*\\/\\.venv\\/.*\",  # .venv directories\n         r\".*\\/my_global_venv\\/.*\",  # venv directories\n"
                },
                {
                    "date": 1757089358096,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -55,8 +55,33 @@\n         r\".*\\/simplegallery\\/.*\", r\".*\\/avatararts\\/.*\", r\".*\\/github\\/.*\",\n         r\".*\\/Documents\\/gitHub\\/.*\", r\".*\\/\\.my_global_venv\\/.*\", r\".*\\/node\\/.*\",\n         r\".*\\/Movies\\/capcut\\/.*\", r\".*\\/miniconda3\\/.*\", r\".*\\/Movies\\/movavi\\/.*\",\n         r\".*\\/env\\/.*\", r\".*\\/\\.env\\/.*\", r\".*\\/Library\\/.*\", r\".*\\/\\.config\\/.*\",\n+        r\".*\\/\\.spicetify\\/.*\", r\".*\\/\\.gem\\/.*\", r\".*\\/\\.zprofile\\/.*\", r\"^.*\\/\\..*\"\n+    ]\n+    file_types = {ext: \"Image\" for ext in [\".jpg\", \".jpeg\", \".png\", \".bmp\", \".gif\", \".tiff\"]}\n+\n+    for directory in directories:\n+        for root, dirs, files in os.walk(directory):\n+            dirs[:] = [d for d in dirs if not any(re.match(pattern, os.path.join(root, d)) for pattern in excluded_patterns)]\n+            for file in files:\n+                file_path = os.path.join(root, file)\n+                if any(re.match(pattern, file_path) for pattern in excluded_patterns):\n+                    continue\n+                file_ext = os.path.splitext(file)[1].lower()\n+                if file_ext in file_types:\n+                    creation_date = get_creation_date(file_path)\n+                    width, height, dpi_x, dpi_y, file_size = get_image_metadata(file_path)\n+                    formatted_size = format_file_size(file_size) if width and height else \"Unknown\"\n+                    rows.append([file, formatted_size, creation_date, width, height, dpi_x, dpi_y, file_path])\n+\n+    write_csv(csv_path, rows)\n+\n+def write_csv(csv_path, rows):\n+    \"\"\"Write data to a CSV file.\"\"\"\n+    with open(csv_path, \"w\", newline=\"\") as csvfile:\n+    # Regex patterns for exclusions\n+    excluded_patterns = [\n         r\"^\\..*\",  # Hidden files and directories\n         r\".*\\/venv\\/.*\",  # venv directories\n         r\".*\\/\\.venv\\/.*\",  # .venv directories\n         r\".*\\/my_global_venv\\/.*\",  # venv directories\n"
                },
                {
                    "date": 1757089367750,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -78,155 +78,45 @@\n \n def write_csv(csv_path, rows):\n     \"\"\"Write data to a CSV file.\"\"\"\n     with open(csv_path, \"w\", newline=\"\") as csvfile:\n-    # Regex patterns for exclusions\n-    excluded_patterns = [\n-        r\"^\\..*\",  # Hidden files and directories\n-        r\".*\\/venv\\/.*\",  # venv directories\n-        r\".*\\/\\.venv\\/.*\",  # .venv directories\n-        r\".*\\/my_global_venv\\/.*\",  # venv directories\n-        r\".*\\/simplegallery\\/.*\",\n-        r\".*\\/avatararts\\/.*\",\n-        r\".*\\/github\\/.*\",\n-        r\".*\\/Documents\\/gitHub\\/.*\",  # Specific gitHub directory\n-        r\".*\\/\\.my_global_venv\\/.*\",  # .venv directories\n-        r\".*\\/node\\/.*\",  # Any directory named node\n-        r\".*\\/Movies\\/capcut\\/.*\",\n-        r\".*\\/miniconda3\\/.*\",\n-        r\".*\\/Movies\\/movavi\\/.*\",\n-        r\".*\\/env\\/.*\",  # env directories\n-        r\".*\\/\\.env\\/.*\",  # .env directories\n-        r\".*\\/Library\\/.*\",  # Library directories\n-        r\".*\\/\\.config\\/.*\",  # .config directories\n-        r\".*\\/\\.spicetify\\/.*\",  # .spicetify directories\n-        r\".*\\/\\.gem\\/.*\",  # .gem directories\n-        r\".*\\/\\.zprofile\\/.*\",  # .zprofile directories\n-        r\"^.*\\/\\..*\",  # Any file or directory starting with a dot\n-    ]\n-\n-    file_types = {\n-        \".jpg\": \"Image\",\n-        \".jpeg\": \"Image\",\n-        \".png\": \"Image\",\n-        \".bmp\": \"Image\",\n-        \".gif\": \"Image\",\n-        \".tiff\": \"Image\",\n-    }\n-\n-    for directory in directories:\n-        for root, dirs, files in os.walk(directory):\n-            # Skip hidden directories and venv directories using regex\n-            dirs[:] = [\n-                d\n-                for d in dirs\n-                if not any(\n-                    re.match(pattern, os.path.join(root, d))\n-                    for pattern in excluded_patterns\n-                )\n-            ]\n-\n-            for file in files:\n-                file_path = os.path.join(root, file)\n-\n-                # Skip files that match the excluded patterns\n-                if any(re.match(pattern, file_path) for pattern in excluded_patterns):\n-                    continue\n-\n-                file_ext = os.path.splitext(file)[1].lower()\n-\n-                # Add file to rows if it matches the logical file types\n-                if file_ext in file_types:\n-                    creation_date = get_creation_date(file_path)\n-                    width, height, dpi_x, dpi_y, file_size = get_image_metadata(\n-                        file_path\n-                    )\n-                    if width is None or height is None:\n-                        formatted_size = \"Unknown\"\n-                    else:\n-                        formatted_size = format_file_size(file_size)\n-                    rows.append(\n-                        [\n-                            file,\n-                            formatted_size,\n-                            creation_date,\n-                            width,\n-                            height,\n-                            dpi_x,\n-                            dpi_y,\n-                            file_path,\n-                        ]\n-                    )\n-\n-    write_csv(csv_path, rows)\n-\n-\n-def write_csv(csv_path, rows):\n-    with open(csv_path, \"w\", newline=\"\") as csvfile:\n-        fieldnames = [\n-            \"Filename\",\n-            \"File Size\",\n-            \"Creation Date\",\n-            \"Width\",\n-            \"Height\",\n-            \"DPI_X\",\n-            \"DPI_Y\",\n-            \"Original Path\",\n-        ]\n+        fieldnames = [\"Filename\", \"File Size\", \"Creation Date\", \"Width\", \"Height\", \"DPI_X\", \"DPI_Y\", \"Original Path\"]\n         writer = csv.DictWriter(csvfile, fieldnames=fieldnames)\n         writer.writeheader()\n         for row in rows:\n-            writer.writerow(\n-                {\n-                    \"Filename\": row[0],\n-                    \"File Size\": row[1],\n-                    \"Creation Date\": row[2],\n-                    \"Width\": row[3],\n-                    \"Height\": row[4],\n-                    \"DPI_X\": row[5],\n-                    \"DPI_Y\": row[6],\n-                    \"Original Path\": row[7],\n-                }\n-            )\n+            writer.writerow(dict(zip(fieldnames, row)))\n \n-\n def get_unique_file_path(base_path):\n+    \"\"\"Generate a unique file path by appending a counter if the file exists.\"\"\"\n     if not os.path.exists(base_path):\n         return base_path\n-\n     base, ext = os.path.splitext(base_path)\n     counter = 1\n     while True:\n         new_path = f\"{base}_{counter}{ext}\"\n         if not os.path.exists(new_path):\n             return new_path\n         counter += 1\n \n-\n def save_last_directory(directory):\n+    \"\"\"Save the last directory to a file.\"\"\"\n     with open(LAST_DIRECTORY_FILE, \"w\") as file:\n         file.write(directory)\n \n-\n def load_last_directory():\n+    \"\"\"Load the last directory from a file.\"\"\"\n     if os.path.exists(LAST_DIRECTORY_FILE):\n         with open(LAST_DIRECTORY_FILE, \"r\") as file:\n             return file.read().strip()\n     return None\n \n-\n if __name__ == \"__main__\":\n     last_directory = load_last_directory()\n-\n     if last_directory:\n         directories = [last_directory]\n     else:\n-        print(\n-            \"No last directory found. Please enter a source directory to scan for image files.\"\n-        )\n-        source_directory = input(\n-            \"Please enter a source directory to scan for image files: \"\n-        ).strip()\n+        print(\"No last directory found. Please enter a source directory to scan for image files.\")\n+        source_directory = input(\"Please enter a source directory to scan for image files: \").strip()\n         if os.path.isdir(source_directory):\n             directories = [source_directory]\n             save_last_directory(source_directory)\n         else:\n"
                },
                {
                    "date": 1757090137935,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -50,14 +50,29 @@\n def generate_csv(directories, csv_path):\n     \"\"\"Generate a CSV for organizing image files.\"\"\"\n     rows = []\n     excluded_patterns = [\n-        r\"^\\..*\", r\".*\\/venv\\/.*\", r\".*\\/\\.venv\\/.*\", r\".*\\/my_global_venv\\/.*\",\n-        r\".*\\/simplegallery\\/.*\", r\".*\\/avatararts\\/.*\", r\".*\\/github\\/.*\",\n-        r\".*\\/Documents\\/gitHub\\/.*\", r\".*\\/\\.my_global_venv\\/.*\", r\".*\\/node\\/.*\",\n-        r\".*\\/Movies\\/capcut\\/.*\", r\".*\\/miniconda3\\/.*\", r\".*\\/Movies\\/movavi\\/.*\",\n-        r\".*\\/env\\/.*\", r\".*\\/\\.env\\/.*\", r\".*\\/Library\\/.*\", r\".*\\/\\.config\\/.*\",\n-        r\".*\\/\\.spicetify\\/.*\", r\".*\\/\\.gem\\/.*\", r\".*\\/\\.zprofile\\/.*\", r\"^.*\\/\\..*\"\n+        r\"^\\..*\",\n+        r\".*\\/venv\\/.*\",\n+        r\".*\\/\\.venv\\/.*\",\n+        r\".*\\/my_global_venv\\/.*\",\n+        r\".*\\/simplegallery\\/.*\",\n+        r\".*\\/avatararts\\/.*\",\n+        r\".*\\/github\\/.*\",\n+        r\".*\\/Documents\\/gitHub\\/.*\",\n+        r\".*\\/\\.my_global_venv\\/.*\",\n+        r\".*\\/node\\/.*\",\n+        r\".*\\/Movies\\/capcut\\/.*\",\n+        r\".*\\/miniconda3\\/.*\",\n+        r\".*\\/Movies\\/movavi\\/.*\",\n+        r\".*\\/env\\/.*\",\n+        r\".*\\/\\.env\\/.*\",\n+        r\".*\\/Library\\/.*\",\n+        r\".*\\/\\.config\\/.*\",\n+        r\".*\\/\\.spicetify\\/.*\",\n+        r\".*\\/\\.gem\\/.*\",\n+        r\".*\\/\\.zprofile\\/.*\",\n+        r\"^.*\\/\\..*\" r\".*\\/avatararts\\/.*\",\n     ]\n     file_types = {ext: \"Image\" for ext in [\".jpg\", \".jpeg\", \".png\", \".bmp\", \".gif\", \".tiff\"]}\n \n     for directory in directories:\n@@ -126,9 +141,8 @@\n     if directories:\n         current_date = datetime.now().strftime(\"%m-%d-%H-%M\")\n         csv_output_path = os.path.join(os.getcwd(), f\"image_data-{current_date}.csv\")\n         csv_output_path = get_unique_file_path(csv_output_path)\n-\n         generate_csv(directories, csv_output_path)\n         print(f\"Dry run completed. Output saved to {csv_output_path}\")\n     else:\n         print(\"No directories were provided to scan.\")\n"
                },
                {
                    "date": 1757090148537,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -70,9 +70,9 @@\n         r\".*\\/\\.config\\/.*\",\n         r\".*\\/\\.spicetify\\/.*\",\n         r\".*\\/\\.gem\\/.*\",\n         r\".*\\/\\.zprofile\\/.*\",\n-        r\"^.*\\/\\..*\" r\".*\\/avatararts\\/.*\",\n+        r\"^.*\\/\\..*\" r\".*\\/\\/.*\",\n     ]\n     file_types = {ext: \"Image\" for ext in [\".jpg\", \".jpeg\", \".png\", \".bmp\", \".gif\", \".tiff\"]}\n \n     for directory in directories:\n"
                },
                {
                    "date": 1757090155186,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -70,9 +70,9 @@\n         r\".*\\/\\.config\\/.*\",\n         r\".*\\/\\.spicetify\\/.*\",\n         r\".*\\/\\.gem\\/.*\",\n         r\".*\\/\\.zprofile\\/.*\",\n-        r\"^.*\\/\\..*\" r\".*\\/\\/.*\",\n+        r\"^.*\\/\\..*\" r\".*\\/firefly-iii\\/.*\",\n     ]\n     file_types = {ext: \"Image\" for ext in [\".jpg\", \".jpeg\", \".png\", \".bmp\", \".gif\", \".tiff\"]}\n \n     for directory in directories:\n"
                },
                {
                    "date": 1757090168241,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -70,9 +70,9 @@\n         r\".*\\/\\.config\\/.*\",\n         r\".*\\/\\.spicetify\\/.*\",\n         r\".*\\/\\.gem\\/.*\",\n         r\".*\\/\\.zprofile\\/.*\",\n-        r\"^.*\\/\\..*\" r\".*\\/firefly-iii\\/.*\",\n+        r\"^.*\\/\\..*\", r\".*\\/firefly-iii\\/.*\",\n     ]\n     file_types = {ext: \"Image\" for ext in [\".jpg\", \".jpeg\", \".png\", \".bmp\", \".gif\", \".tiff\"]}\n \n     for directory in directories:\n"
                },
                {
                    "date": 1757090175072,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -70,9 +70,9 @@\n         r\".*\\/\\.config\\/.*\",\n         r\".*\\/\\.spicetify\\/.*\",\n         r\".*\\/\\.gem\\/.*\",\n         r\".*\\/\\.zprofile\\/.*\",\n-        r\"^.*\\/\\..*\", r\".*\\/firefly-iii\\/.*\",\n+        r\"^.*\\/\\..*\", r\".*\\/firefly-iii\\/.*\"\n     ]\n     file_types = {ext: \"Image\" for ext in [\".jpg\", \".jpeg\", \".png\", \".bmp\", \".gif\", \".tiff\"]}\n \n     for directory in directories:\n"
                },
                {
                    "date": 1757090189953,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -70,9 +70,11 @@\n         r\".*\\/\\.config\\/.*\",\n         r\".*\\/\\.spicetify\\/.*\",\n         r\".*\\/\\.gem\\/.*\",\n         r\".*\\/\\.zprofile\\/.*\",\n-        r\"^.*\\/\\..*\", r\".*\\/firefly-iii\\/.*\"\n+        r\"^.*\\/\\..*\",\n+        r\".*\\/firefly-iii\\/.*\",\n+        r\".*\\/avatararts\\/.*\",\n     ]\n     file_types = {ext: \"Image\" for ext in [\".jpg\", \".jpeg\", \".png\", \".bmp\", \".gif\", \".tiff\"]}\n \n     for directory in directories:\n"
                },
                {
                    "date": 1757090195388,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -72,9 +72,9 @@\n         r\".*\\/\\.gem\\/.*\",\n         r\".*\\/\\.zprofile\\/.*\",\n         r\"^.*\\/\\..*\",\n         r\".*\\/firefly-iii\\/.*\",\n-        r\".*\\/avatararts\\/.*\",\n+        r\".*\\/go\\/.*\",\n     ]\n     file_types = {ext: \"Image\" for ext in [\".jpg\", \".jpeg\", \".png\", \".bmp\", \".gif\", \".tiff\"]}\n \n     for directory in directories:\n"
                },
                {
                    "date": 1757090204823,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -73,8 +73,9 @@\n         r\".*\\/\\.zprofile\\/.*\",\n         r\"^.*\\/\\..*\",\n         r\".*\\/firefly-iii\\/.*\",\n         r\".*\\/go\\/.*\",\n+        r\".*\\/avatararts\\/.*\",\n     ]\n     file_types = {ext: \"Image\" for ext in [\".jpg\", \".jpeg\", \".png\", \".bmp\", \".gif\", \".tiff\"]}\n \n     for directory in directories:\n"
                },
                {
                    "date": 1757090215750,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -73,9 +73,9 @@\n         r\".*\\/\\.zprofile\\/.*\",\n         r\"^.*\\/\\..*\",\n         r\".*\\/firefly-iii\\/.*\",\n         r\".*\\/go\\/.*\",\n-        r\".*\\/avatararts\\/.*\",\n+        r\".*\\/resourceboy\\/.*\",\n     ]\n     file_types = {ext: \"Image\" for ext in [\".jpg\", \".jpeg\", \".png\", \".bmp\", \".gif\", \".tiff\"]}\n \n     for directory in directories:\n"
                },
                {
                    "date": 1757090236564,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -73,9 +73,9 @@\n         r\".*\\/\\.zprofile\\/.*\",\n         r\"^.*\\/\\..*\",\n         r\".*\\/firefly-iii\\/.*\",\n         r\".*\\/go\\/.*\",\n-        r\".*\\/resourceboy\\/.*\",\n+        r\".*\\/resourceboy\\/.*\"\n     ]\n     file_types = {ext: \"Image\" for ext in [\".jpg\", \".jpeg\", \".png\", \".bmp\", \".gif\", \".tiff\"]}\n \n     for directory in directories:\n"
                }
            ],
            "date": 1757089334666,
            "name": "Commit-0",
            "content": "import csv\nimport os\nimport re\nfrom datetime import datetime\nfrom PIL import Image\n\n# Constants\nLAST_DIRECTORY_FILE = \"image_data.txt\"\n\ndef get_creation_date(filepath):\n    \"\"\"Get the creation date of a file.\"\"\"\n    try:\n        timestamp = os.path.getctime(filepath)\n        return datetime.fromtimestamp(timestamp).strftime(\"%m-%d-%y\")\n    except Exception as e:\n        print(f\"Error getting creation date for {filepath}: {e}\")\n        return \"Unknown\"\n\ndef get_image_metadata(filepath):\n    \"\"\"Extract metadata from an image file using PIL.\"\"\"\n    try:\n        with Image.open(filepath) as img:\n            width, height = img.size\n            dpi = img.info.get(\"dpi\", (None, None))  # Extract DPI if available\n            dpi_x = dpi[0] if dpi and len(dpi) > 0 else None\n            dpi_y = dpi[1] if dpi and len(dpi) > 1 else None\n            file_size = os.path.getsize(filepath)\n            return width, height, dpi_x, dpi_y, file_size\n    except Exception as e:\n        print(f\"Error getting image metadata for {filepath}: {e}\")\n        return None, None, None, None, None\n\n\n# Function to format file size\ndef format_file_size(size_in_bytes):\n    try:\n        thresholds = [\n            (1024**4, \"TB\"),\n            (1024**3, \"GB\"),\n            (1024**2, \"MB\"),\n            (1024**1, \"KB\"),\n            (1024**0, \"B\"),\n        ]\n        for factor, suffix in thresholds:\n            if size_in_bytes >= factor:\n                break\n        return f\"{size_in_bytes / factor:.2f} {suffix}\"\n    except Exception as e:\n        print(f\"Error formatting file size: {e}\")\n        return \"Unknown\"\n\n\n# Function to generate a CSV for organizing image files\ndef generate_csv(directories, csv_path):\n    rows = []\n\n    # Regex patterns for exclusions\n    excluded_patterns = [\n        r\"^\\..*\",  # Hidden files and directories\n        r\".*\\/venv\\/.*\",  # venv directories\n        r\".*\\/\\.venv\\/.*\",  # .venv directories\n        r\".*\\/my_global_venv\\/.*\",  # venv directories\n        r\".*\\/simplegallery\\/.*\",\n        r\".*\\/avatararts\\/.*\",\n        r\".*\\/github\\/.*\",\n        r\".*\\/Documents\\/gitHub\\/.*\",  # Specific gitHub directory\n        r\".*\\/\\.my_global_venv\\/.*\",  # .venv directories\n        r\".*\\/node\\/.*\",  # Any directory named node\n        r\".*\\/Movies\\/capcut\\/.*\",\n        r\".*\\/miniconda3\\/.*\",\n        r\".*\\/Movies\\/movavi\\/.*\",\n        r\".*\\/env\\/.*\",  # env directories\n        r\".*\\/\\.env\\/.*\",  # .env directories\n        r\".*\\/Library\\/.*\",  # Library directories\n        r\".*\\/\\.config\\/.*\",  # .config directories\n        r\".*\\/\\.spicetify\\/.*\",  # .spicetify directories\n        r\".*\\/\\.gem\\/.*\",  # .gem directories\n        r\".*\\/\\.zprofile\\/.*\",  # .zprofile directories\n        r\"^.*\\/\\..*\",  # Any file or directory starting with a dot\n    ]\n\n    file_types = {\n        \".jpg\": \"Image\",\n        \".jpeg\": \"Image\",\n        \".png\": \"Image\",\n        \".bmp\": \"Image\",\n        \".gif\": \"Image\",\n        \".tiff\": \"Image\",\n    }\n\n    for directory in directories:\n        for root, dirs, files in os.walk(directory):\n            # Skip hidden directories and venv directories using regex\n            dirs[:] = [\n                d\n                for d in dirs\n                if not any(\n                    re.match(pattern, os.path.join(root, d))\n                    for pattern in excluded_patterns\n                )\n            ]\n\n            for file in files:\n                file_path = os.path.join(root, file)\n\n                # Skip files that match the excluded patterns\n                if any(re.match(pattern, file_path) for pattern in excluded_patterns):\n                    continue\n\n                file_ext = os.path.splitext(file)[1].lower()\n\n                # Add file to rows if it matches the logical file types\n                if file_ext in file_types:\n                    creation_date = get_creation_date(file_path)\n                    width, height, dpi_x, dpi_y, file_size = get_image_metadata(\n                        file_path\n                    )\n                    if width is None or height is None:\n                        formatted_size = \"Unknown\"\n                    else:\n                        formatted_size = format_file_size(file_size)\n                    rows.append(\n                        [\n                            file,\n                            formatted_size,\n                            creation_date,\n                            width,\n                            height,\n                            dpi_x,\n                            dpi_y,\n                            file_path,\n                        ]\n                    )\n\n    write_csv(csv_path, rows)\n\n\ndef write_csv(csv_path, rows):\n    with open(csv_path, \"w\", newline=\"\") as csvfile:\n        fieldnames = [\n            \"Filename\",\n            \"File Size\",\n            \"Creation Date\",\n            \"Width\",\n            \"Height\",\n            \"DPI_X\",\n            \"DPI_Y\",\n            \"Original Path\",\n        ]\n        writer = csv.DictWriter(csvfile, fieldnames=fieldnames)\n        writer.writeheader()\n        for row in rows:\n            writer.writerow(\n                {\n                    \"Filename\": row[0],\n                    \"File Size\": row[1],\n                    \"Creation Date\": row[2],\n                    \"Width\": row[3],\n                    \"Height\": row[4],\n                    \"DPI_X\": row[5],\n                    \"DPI_Y\": row[6],\n                    \"Original Path\": row[7],\n                }\n            )\n\n\ndef get_unique_file_path(base_path):\n    if not os.path.exists(base_path):\n        return base_path\n\n    base, ext = os.path.splitext(base_path)\n    counter = 1\n    while True:\n        new_path = f\"{base}_{counter}{ext}\"\n        if not os.path.exists(new_path):\n            return new_path\n        counter += 1\n\n\ndef save_last_directory(directory):\n    with open(LAST_DIRECTORY_FILE, \"w\") as file:\n        file.write(directory)\n\n\ndef load_last_directory():\n    if os.path.exists(LAST_DIRECTORY_FILE):\n        with open(LAST_DIRECTORY_FILE, \"r\") as file:\n            return file.read().strip()\n    return None\n\n\nif __name__ == \"__main__\":\n    last_directory = load_last_directory()\n\n    if last_directory:\n        directories = [last_directory]\n    else:\n        print(\n            \"No last directory found. Please enter a source directory to scan for image files.\"\n        )\n        source_directory = input(\n            \"Please enter a source directory to scan for image files: \"\n        ).strip()\n        if os.path.isdir(source_directory):\n            directories = [source_directory]\n            save_last_directory(source_directory)\n        else:\n            print(f\"'{source_directory}' is not a valid directory. Exiting.\")\n            exit(1)\n\n    if directories:\n        current_date = datetime.now().strftime(\"%m-%d-%H-%M\")\n        csv_output_path = os.path.join(os.getcwd(), f\"image_data-{current_date}.csv\")\n        csv_output_path = get_unique_file_path(csv_output_path)\n\n        generate_csv(directories, csv_output_path)\n        print(f\"Dry run completed. Output saved to {csv_output_path}\")\n    else:\n        print(\"No directories were provided to scan.\")\n"
        }
    ]
}