{
    "sourceFile": "CSV/autofill.py",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1748660272532,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1748660272532,
            "name": "Commit-0",
            "content": "import csv\nimport json\nimport os\nfrom pathlib import Path\nfrom dotenv import load_dotenv\nfrom openai import OpenAI\nfrom tqdm import tqdm\n\n# CONFIG\nload_dotenv(os.path.expanduser(\"~/.env\"))\nOPENAI_API_KEY = os.getenv(\"OPENAI_API_KEY\")\nclient = OpenAI(api_key=OPENAI_API_KEY)\nCSV_PATH = \"/Users/steven/Documents/python/clean/CSV/prompts_expanded_image_data-05-30-22-21.csv\"\nOUT_CSV = \"/Users/steven/Documents/python/clean/CSV/filled_prompts_expanded_image_data-05-30-22-21.csv\"\nLOG_PATH = \"/Users/steven/Documents/python/clean/CSV/fill_log.txt\"\n\n# List analytic fields and prompt fields to fill\nANALYSIS_FIELDS = [\n    \"main_subject\", \"style\", \"color_palette\", \"tags\", \"orientation\",\n    \"suggested_products\", \"SEO_title\", \"SEO_description\", \"emotion\",\n    \"safety_rating\", \"dominant_keyword\"\n]\nPROMPT_PREFIX = \"Prompt_\"\n\ndef gpt_fill(context_dict, field, style=None):\n    sys_prompt = (\n        \"You are a creative AI for print-on-demand design and SEO. \"\n        \"Given image info and the current row's context, fill in the missing field with a relevant, detailed, SEO-optimized answer.\"\n    )\n    if style:\n        user_prompt = (\n            f\"Given the context: {json.dumps(context_dict)}\\n\"\n            f\"Generate a product-ready, descriptive, SEO-friendly image prompt for the style: '{style}'.\"\n        )\n    else:\n        user_prompt = (\n            f\"Given the context: {json.dumps(context_dict)}\\n\"\n            f\"Generate a creative and SEO-optimized value for the field '{field}'.\"\n        )\n    response = client.chat.completions.create(\n        model=\"gpt-4o\",\n        messages=[\n            {\"role\": \"system\", \"content\": sys_prompt},\n            {\"role\": \"user\", \"content\": user_prompt}\n        ],\n        max_tokens=200,\n        temperature=0.8,\n    )\n    return response.choices[0].message.content.strip()\n\ndef fill_missing_fields(in_csv, out_csv, log_file):\n    with open(in_csv, newline='', encoding='utf-8') as infile, \\\n         open(out_csv, 'w', newline='', encoding='utf-8') as outfile, \\\n         open(log_file, 'w', encoding='utf-8') as logf:\n        reader = csv.DictReader(infile)\n        fieldnames = reader.fieldnames or []\n        writer = csv.DictWriter(outfile, fieldnames=fieldnames)\n        writer.writeheader()\n        for idx, row in enumerate(tqdm(reader, desc=\"Filling missing fields\", unit=\"row\")):\n            context = {k: v for k, v in row.items() if v.strip()}\n            # Fill missing analytic fields\n            for field in ANALYSIS_FIELDS:\n                if field in row and not row[field].strip():\n                    filled = gpt_fill(context, field)\n                    row[field] = filled\n                    logf.write(f\"Row {idx+2}, field '{field}' filled: {filled}\\n\")\n                    context[field] = filled\n            # Fill missing prompt columns\n            for field in fieldnames:\n                if field.startswith(PROMPT_PREFIX) and not row[field].strip():\n                    style = field.replace(PROMPT_PREFIX, \"\")\n                    filled = gpt_fill(context, field, style=style)\n                    row[field] = filled\n                    logf.write(f\"Row {idx+2}, field '{field}' filled: {filled}\\n\")\n            writer.writerow(row)\n    print(f\"\\nâœ… All missing fields filled. Output: {out_csv}\\nLog of filled fields: {log_file}\")\n\nif __name__ == \"__main__\":\n    fill_missing_fields(CSV_PATH, OUT_CSV, LOG_PATH)\n"
        }
    ]
}